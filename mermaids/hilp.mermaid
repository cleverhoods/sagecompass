flowchart TD
    Start([Thread Start]) --> Supervisor

    %% SUPERVISOR
    Supervisor[supervisor node] -->|user_lang missing| DetectLang
    Supervisor -->|problem_framing incomplete| PF[problem_framing node]
    Supervisor -->|problem_framing complete| Translator

    %% DETECT LANGUAGE
    DetectLang --> Supervisor

    %% PROBLEM FRAMING + HILP
    PF --> PF_Agent[pf_agent (middleware attached)]
    PF_Agent -->|structured_response| HilpMW[boolean HILP middleware\n(runtime.human)]
    HilpMW --> PF_Record[store phase data\n+ hilp_meta/clarifications]
    PF_Record --> Supervisor

    %% TRANSLATION / END
    Translator --> End((END))

contracts:
  - id: contract.agents
    name: Agent OutputSchema contract
    path: app/platform/adapters/agents.py
    benefit: Validates each agent's Pydantic OutputSchema so nodes can trust strictly typed structured responses (no raw dict/Any leakage). Runtime wrapper that loads schemas and validates them.
    consumers:
      - agents
  - id: contract.tools
    name: Tool allowlist contract
    path: app/platform/adapters/tools.py (builder) + app/platform/core/contract/tools.py (validator)
    benefit: Builds the canonical tool allowlist via adapter wrapper, and validates allowlist contains schema via pure contract validator. Ensures middleware and agents call only approved tool names.
    consumers:
      - agents
      - middlewares
  - id: contract.guardrails
    name: Guardrails evaluation contract
    path: app/platform/adapters/guardrails.py
    benefit: Routes guardrail checks through the shared policy entrypoint (evaluate_guardrails_contract) so middleware and gating nodes reject the same unsafe/out-of-scope prompts. Adapter wrapper that coordinates policy with config building.
    consumers:
      - middlewares
      - gating nodes
  - id: contract.prompts
    name: Prompt placeholder contract
    path: app/platform/core/contract/prompts.py
    benefit: Validates required prompt placeholders and suffix ordering so dynamic prompt middleware renders deterministic, well-formed system prompts.
    consumers:
      - agents
  - id: contract.state
    name: SageState ownership contract
    path: app/platform/core/contract/state.py
    benefit: Restricts SageState updates to known top-level fields and owner groups so nodes can't mutate unauthorized data.
    consumers:
      - nodes
      - supervisors
  - id: contract.structured_output
    name: Structured-answer validation contract
    path: app/platform/core/contract/structured_output.py
    benefit: Forces nodes to extract `structured_response` and validate it against the agent schema before persisting phase data, surfacing failures explicitly.
    consumers:
      - nodes
  - id: contract.phases
    name: Phase registry contract
    path: app/platform/core/contract/registry.py
    benefit: Ensures each `PhaseContract` key matches its `name` and declares a BaseModel `output_schema`, keeping phase wiring predictable.
    consumers:
      - graphs
  - id: contract.namespaces
    name: Store namespace contract
    path: app/platform/core/contract/namespaces.py
    benefit: Provides typed namespace parts so store-oriented tools build consistent, tenant-aware namespaces for read/write operations.
    consumers:
      - tools
  - id: contract.evidence
    name: Evidence hydration contract
    path: app/platform/adapters/evidence.py
    benefit: Requires nodes to call `collect_phase_evidence` adapter wrapper, respect the `missing_store` flag, and hydrate deterministic metadata before mutating phase state. Returns pure EvidenceBundle DTO while coordinating with runtime and logging.
    consumers:
      - nodes
  - id: contract.logging
    name: Structured logging contract
    path: app/platform/adapters/logging.py
    benefit: Demands that nodes, agents, and related components use `get_logger`/`configure_logging` adapter wrappers so all emissions stay in the structured pipeline instead of ad-hoc stdlib logging. Coordinates with observability layer.
    consumers:
      - agents
      - nodes
      - middlewares
      - tools
